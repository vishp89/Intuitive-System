# .github/workflows/update-dashboard.yml
name: Update Portfolio Dashboard

on:
  workflow_dispatch:
    inputs:
      kairos_progress:
        description: 'Kairos Progress %'
        required: true
        default: '35'
      ey_progress:
        description: 'EY Progress %'
        required: true
        default: '60'
      beginning_progress:
        description: 'Beginning Progress %'
        required: true
        default: '20'
      portfolio_momentum:
        description: 'Portfolio Momentum %'
        required: true
        default: '78'
      todays_focus:
        description: 'Today Focus'
        required: true
        default: 'Strategic execution'

jobs:
  update-dashboard:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
      with:
        token: ${{ secrets.REPO_TOKEN }}
    
    - name: Update dashboard
      run: |
        # Simple updates without complex regex
        python3 << 'EOF'
        import re
        
        # Read the HTML file
        with open('index.html', 'r') as file:
            content = file.read()
        
        # Update momentum value
        content = re.sub(
            r'id="momentum-value" class="text-3xl font-bold text-gray-900">\d+%',
            f'id="momentum-value" class="text-3xl font-bold text-gray-900">${{ inputs.portfolio_momentum }}%',
            content
        )
        
        # Update momentum bar
        content = re.sub(
            r'id="momentum-bar"[^>]*style="width: \d+%"',
            f'id="momentum-bar" class="bg-blue-600 h-2 rounded-full progress-bar" style="width: ${{ inputs.portfolio_momentum }}%"',
            content
        )
        
        # Update today's focus
        content = re.sub(
            r'<p class="text-lg opacity-90" id="todays-focus">[^<]*</p>',
            f'<p class="text-lg opacity-90" id="todays-focus">${{ inputs.todays_focus }}</p>',
            content
        )
        
        # Write back
        with open('index.html', 'w') as file:
            file.write(content)
        EOF
    
    - name: Commit changes
      run: |
        git config --local user.email "watson@portfolio.ai"
        git config --local user.name "Portfolio Watson"
        git add index.html
        git commit -m "Dashboard update: ${{ inputs.portfolio_momentum }}% momentum" || exit 0
        git push
