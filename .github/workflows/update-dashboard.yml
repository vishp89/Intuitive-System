# .github/workflows/update-dashboard.yml
# Allows Watson to automatically update dashboard with real progress data

name: Update Portfolio Dashboard

on:
  # Triggered manually with project data
  workflow_dispatch:
    inputs:
      kairos_progress:
        description: 'Kairos Design Agency Progress %'
        required: false
        default: '35'
        type: string
      ey_progress:
        description: 'EY Studio+ Positioning Progress %'
        required: false
        default: '60'
        type: string
      beginning_progress:
        description: 'The Beginning Partnership Progress %'
        required: false
        default: '20'
        type: string
      bobo_progress:
        description: 'Bobo Wine Revival Progress %'
        required: false
        default: '15'
        type: string
      bha_progress:
        description: 'Brooklyn Heights Association Progress %'
        required: false
        default: '40'
        type: string
      portfolio_momentum:
        description: 'Overall Portfolio Momentum %'
        required: false
        default: '78'
        type: string
      todays_focus:
        description: 'Today\'s Strategic Focus'
        required: false
        default: 'The Beginning meeting prep & Kairos domain acquisition'
        type: string
      kairos_next_action:
        description: 'Kairos Next Action'
        required: false
        default: 'Secure domain & The Beginning prep'
        type: string
      ey_next_action:
        description: 'EY Next Action'
        required: false
        default: 'Ecosystem partnership mapping'
        type: string
      beginning_next_action:
        description: 'The Beginning Next Action'
        required: false
        default: 'Meeting preparation & research'
        type: string
      bobo_next_action:
        description: 'Bobo Next Action'
        required: false
        default: 'Customer experience workshop design'
        type: string
      bha_next_action:
        description: 'BHA Next Action'
        required: false
        default: 'Community engagement planning'
        type: string

jobs:
  update-dashboard:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.REPO_TOKEN }}
    
    - name: Update dashboard with new data
      run: |
        # Update portfolio momentum
        sed -i "s/id=\"momentum-value\" class=\"text-3xl font-bold text-gray-900\">[0-9]*%/id=\"momentum-value\" class=\"text-3xl font-bold text-gray-900\">${{ github.event.inputs.portfolio_momentum }}%/g" index.html
        sed -i "s/id=\"momentum-bar\" class=\"bg-blue-600 h-2 rounded-full progress-bar\" style=\"width: [0-9]*%\"/id=\"momentum-bar\" class=\"bg-blue-600 h-2 rounded-full progress-bar\" style=\"width: ${{ github.event.inputs.portfolio_momentum }}%\"/g" index.html
        
        # Update today's focus
        sed -i "s/<p class=\"text-lg opacity-90\" id=\"todays-focus\">.*<\/p>/<p class=\"text-lg opacity-90\" id=\"todays-focus\">${{ github.event.inputs.todays_focus }}<\/p>/g" index.html
        
        # Update Kairos progress
        sed -i 's/<span id="kairos-progress">[0-9]*%/<span id="kairos-progress">${{ github.event.inputs.kairos_progress }}%/g' index.html
        sed -i 's/style="width: 35%"/style="width: ${{ github.event.inputs.kairos_progress }}%"/g' index.html
        
        # Update EY progress
        sed -i 's/style="width: 60%"/style="width: ${{ github.event.inputs.ey_progress }}%"/g' index.html
        
        # Update The Beginning progress  
        sed -i 's/style="width: 20%"/style="width: ${{ github.event.inputs.beginning_progress }}%"/g' index.html
        
        # Update Bobo progress
        sed -i 's/style="width: 15%"/style="width: ${{ github.event.inputs.bobo_progress }}%"/g' index.html
        
        # Update BHA progress
        sed -i 's/style="width: 40%"/style="width: ${{ github.event.inputs.bha_progress }}%"/g' index.html
    
    - name: Update next actions
      run: |
        # Update next action descriptions
        sed -i 's/Secure domain & The Beginning prep/${{ github.event.inputs.kairos_next_action }}/g' index.html
        sed -i 's/Ecosystem partnership mapping/${{ github.event.inputs.ey_next_action }}/g' index.html
        sed -i 's/Meeting preparation & research/${{ github.event.inputs.beginning_next_action }}/g' index.html
        sed -i 's/Customer experience workshop design/${{ github.event.inputs.bobo_next_action }}/g' index.html
        sed -i 's/Community engagement planning/${{ github.event.inputs.bha_next_action }}/g' index.html
    
    - name: Add timestamp
      run: |
        # Add last updated timestamp
        TIMESTAMP=$(date '+%Y-%m-%d %H:%M UTC')
        sed -i "s/<p class=\"text-gray-600 mt-1\">Real-time execution dashboard/<p class=\"text-gray-600 mt-1\">Last updated: $TIMESTAMP â€¢ Real-time execution dashboard/g" index.html
    
    - name: Commit and push changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "Portfolio Watson"
        git add index.html
        git commit -m "Update dashboard: Portfolio ${{ github.event.inputs.portfolio_momentum }}% | Kairos ${{ github.event.inputs.kairos_progress }}% | EY ${{ github.event.inputs.ey_progress }}% | Beginning ${{ github.event.inputs.beginning_progress }}% | Bobo ${{ github.event.inputs.bobo_progress }}% | BHA ${{ github.event.inputs.bha_progress }}%" || exit 0
        git push
